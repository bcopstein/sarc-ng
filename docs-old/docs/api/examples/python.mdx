---
sidebar_position: 2
---

# Python Examples

Integration examples for using the SARC-NG API with Python.

## API Client Setup

First, let's create a simple Python API client for SARC-NG:

```python
import requests
from datetime import datetime
from typing import Optional, Dict, List, Any, Union

class SarcApiClient:
    def __init__(self, base_url: str = "http://localhost:8080/api/v1"):
        self.base_url = base_url
        self.session = requests.Session()
        self.session.headers.update({
            'Content-Type': 'application/json'
        })

    def set_auth_token(self, token: Optional[str] = None) -> None:
        """Set or clear the authorization token for API requests"""
        if token:
            self.session.headers['Authorization'] = f"Bearer {token}"
        elif 'Authorization' in self.session.headers:
            del self.session.headers['Authorization']

    def _handle_response(self, response: requests.Response) -> Dict[str, Any]:
        """Handle API responses and errors"""
        if response.status_code == 204:  # No Content
            return {"success": True}

        if not response.content:  # Empty response
            return {"success": True}

        try:
            data = response.json()
        except ValueError:
            raise ValueError(f"Invalid JSON response: {response.text}")

        if not response.ok:
            error_msg = data.get('message', 'Unknown error')
            error_code = data.get('error', 'Error')
            raise ApiError(
                status_code=response.status_code,
                error=error_code,
                message=error_msg,
                details=data.get('details')
            )

        return data

    def request(self,
                endpoint: str,
                method: str = 'GET',
                data: Optional[Dict] = None,
                params: Optional[Dict] = None) -> Dict[str, Any]:
        """Make a request to the API"""
        url = f"{self.base_url}{endpoint}"

        try:
            response = self.session.request(
                method=method,
                url=url,
                json=data,
                params=params
            )
            return self._handle_response(response)
        except requests.RequestException as e:
            raise ConnectionError(f"Connection error: {str(e)}")

    # Buildings
    def get_buildings(self, page: int = 1, limit: int = 50) -> Dict[str, Any]:
        """Get a list of buildings"""
        return self.request('/buildings', params={'page': page, 'limit': limit})

    def get_building(self, building_id: int) -> Dict[str, Any]:
        """Get a specific building by ID"""
        return self.request(f'/buildings/{building_id}')

    def create_building(self, name: str, code: str) -> Dict[str, Any]:
        """Create a new building"""
        data = {"name": name, "code": code}
        return self.request('/buildings', method='POST', data=data)

    def update_building(self, building_id: int, name: str, code: str) -> Dict[str, Any]:
        """Update an existing building"""
        data = {"id": building_id, "name": name, "code": code}
        return self.request(f'/buildings/{building_id}', method='PUT', data=data)

    def delete_building(self, building_id: int) -> Dict[str, Any]:
        """Delete a building"""
        return self.request(f'/buildings/{building_id}', method='DELETE')

    # Resources
    def get_resources(self,
                      resource_type: Optional[str] = None,
                      page: int = 1,
                      limit: int = 50) -> Dict[str, Any]:
        """Get a list of resources, optionally filtered by type"""
        params = {'page': page, 'limit': limit}
        if resource_type:
            params['type'] = resource_type
        return self.request('/resources', params=params)

    def get_resource(self, resource_id: int) -> Dict[str, Any]:
        """Get a specific resource by ID"""
        return self.request(f'/resources/{resource_id}')

    def create_resource(self,
                       name: str,
                       resource_type: str,
                       is_available: bool = True,
                       description: Optional[str] = None) -> Dict[str, Any]:
        """Create a new resource"""
        data = {
            "name": name,
            "type": resource_type,
            "isAvailable": is_available
        }
        if description:
            data["description"] = description

        return self.request('/resources', method='POST', data=data)

    # Reservations
    def get_reservations(self,
                         from_date: Optional[str] = None,
                         to_date: Optional[str] = None,
                         resource_id: Optional[int] = None,
                         page: int = 1,
                         limit: int = 50) -> Dict[str, Any]:
        """Get a list of reservations with optional filters"""
        params = {'page': page, 'limit': limit}

        if from_date:
            params['fromDate'] = from_date
        if to_date:
            params['toDate'] = to_date
        if resource_id:
            params['resourceId'] = resource_id

        return self.request('/reservations', params=params)

    def create_reservation(self,
                          resource_id: int,
                          user_id: int,
                          start_time: str,
                          end_time: str,
                          purpose: str,
                          description: Optional[str] = None) -> Dict[str, Any]:
        """Create a new reservation"""
        data = {
            "resourceId": resource_id,
            "userId": user_id,
            "startTime": start_time,
            "endTime": end_time,
            "purpose": purpose
        }

        if description:
            data["description"] = description

        return self.request('/reservations', method='POST', data=data)

    def update_reservation_status(self,
                                 reservation_id: int,
                                 status: str) -> Dict[str, Any]:
        """Update the status of a reservation"""
        data = {"status": status}
        return self.request(
            f'/reservations/{reservation_id}/status',
            method='PUT',
            data=data
        )


class ApiError(Exception):
    """Exception raised for API errors"""
    def __init__(self, status_code, error, message, details=None):
        self.status_code = status_code
        self.error = error
        self.message = message
        self.details = details
        super().__init__(f"{status_code} {error}: {message}")
```

## Interactive Demo

```python
import json
from datetime import datetime, timedelta

# Create API client
client = SarcApiClient("http://localhost:8080/api/v1")

def display_buildings():
    """Get and display buildings"""
    try:
        result = client.get_buildings()
        buildings = result.get("data", [])

        print("\n=== Buildings ===")
        for building in buildings:
            print(f"ID: {building['id']}")
            print(f"Name: {building['name']}")
            print(f"Code: {building['code']}")
            print(f"Created: {building['createdAt']}")
            print("-" * 20)

        # Show pagination info if available
        if "pagination" in result:
            pag = result["pagination"]
            print(f"Page {pag['page']} of {pag['pages']} (Total: {pag['total']} buildings)")

    except ApiError as e:
        print(f"API Error: {e}")
    except ConnectionError as e:
        print(f"Connection Error: {e}")

def create_building(name, code):
    """Create a new building"""
    try:
        result = client.create_building(name, code)
        print(f"\nBuilding created successfully!")
        print(f"ID: {result.get('id')}")
        print(f"Name: {result.get('name')}")
        print(f"Code: {result.get('code')}")
        return True
    except ApiError as e:
        print(f"Failed to create building: {e}")
        if e.details:
            print("Validation errors:")
            for detail in e.details:
                print(f"- {detail.get('field')}: {detail.get('message')}")
        return False

def reserve_resource(resource_id, purpose):
    """Create a reservation for a resource"""
    try:
        # Use current time and reserve for 1 hour
        start_time = datetime.now().isoformat()
        end_time = (datetime.now() + timedelta(hours=1)).isoformat()

        result = client.create_reservation(
            resource_id=resource_id,
            user_id=123,  # Demo user ID
            start_time=start_time,
            end_time=end_time,
            purpose=purpose
        )

        print(f"\nReservation created successfully!")
        print(f"ID: {result.get('id')}")
        print(f"Resource ID: {result.get('resourceId')}")
        print(f"Start: {result.get('startTime')}")
        print(f"End: {result.get('endTime')}")
        print(f"Status: {result.get('status')}")
        return True
    except ApiError as e:
        print(f"Failed to create reservation: {e}")
        # Handle conflicts specifically
        if e.status_code == 409:
            print("The resource is not available during the requested time.")
        return False

# Example usage
if __name__ == "__main__":
    # Display existing buildings
    display_buildings()

    # Create a new building
    create_building("New Science Center", "NSC-05")

    # Display buildings again to see the new one
    display_buildings()

    # Create a reservation
    reserve_resource(1, "Team Meeting")
```

## Usage Examples

### Authentication

```python
def login(username, password):
    """Authenticate with the API and store token"""
    try:
        response = requests.post(
            "http://localhost:8080/api/v1/auth/login",
            json={"username": username, "password": password}
        )

        if not response.ok:
            data = response.json()
            print(f"Login failed: {data.get('message', 'Unknown error')}")
            return False

        data = response.json()
        token = data.get('access_token')

        # Set the token in the client
        client.set_auth_token(token)

        # Store token (in a real app, use a secure method)
        with open(".token", "w") as f:
            f.write(token)

        print("Login successful!")
        return True
    except Exception as e:
        print(f"Login error: {e}")
        return False

def load_saved_token():
    """Load saved token if it exists"""
    try:
        with open(".token", "r") as f:
            token = f.read().strip()
            if token:
                client.set_auth_token(token)
                return True
    except FileNotFoundError:
        pass
    return False
```

### Working with Resources

```python
def list_available_resources(resource_type=None, from_date=None, to_date=None):
    """List resources that are available for booking"""
    params = {}
    if resource_type:
        params['type'] = resource_type
    if from_date:
        params['fromDate'] = from_date
    if to_date:
        params['toDate'] = to_date

    try:
        result = client.request('/resources/available', params=params)
        resources = result.get('data', [])

        print(f"\n=== Available Resources ===")
        for resource in resources:
            print(f"ID: {resource['id']}")
            print(f"Name: {resource['name']}")
            print(f"Type: {resource['type']}")
            print("-" * 20)

        return resources
    except ApiError as e:
        print(f"Error listing resources: {e}")
        return []

def check_resource_availability(resource_id, start_time, end_time):
    """Check if a resource is available during a specific time period"""
    params = {
        'resourceId': resource_id,
        'startTime': start_time,
        'endTime': end_time
    }

    try:
        result = client.request('/reservations/check-availability', params=params)
        is_available = result.get('available', False)

        if is_available:
            print(f"Resource {resource_id} is available during the requested time period!")
        else:
            conflicts = result.get('conflicts', [])
            print(f"Resource {resource_id} is NOT available. Conflicts:")
            for conflict in conflicts:
                print(f"- {conflict.get('startTime')} to {conflict.get('endTime')}")
                print(f"  Purpose: {conflict.get('purpose')}")

        return is_available
    except ApiError as e:
        print(f"Error checking availability: {e}")
        return False
```

### Batch Operations

```python
def batch_create_buildings(buildings_data):
    """Create multiple buildings in batch"""
    results = []

    for building in buildings_data:
        try:
            result = client.create_building(
                name=building['name'],
                code=building['code']
            )
            results.append({
                'success': True,
                'data': result
            })
        except ApiError as e:
            results.append({
                'success': False,
                'error': str(e),
                'details': e.details
            })

    # Summary
    success_count = sum(1 for r in results if r['success'])
    print(f"Created {success_count} of {len(buildings_data)} buildings")

    # Failed items
    if success_count < len(buildings_data):
        print("Failed items:")
        for i, result in enumerate(results):
            if not result['success']:
                print(f"Item {i+1}: {result['error']}")

    return results

# Example batch data
buildings = [
    {'name': 'Engineering Building', 'code': 'ENG-A'},
    {'name': 'Arts Center', 'code': 'ART-B'},
    {'name': 'Student Union', 'code': 'SU-C'},
]

batch_results = batch_create_buildings(buildings)
```

### Data Export

```python
def export_reservations_to_csv(filename, from_date=None, to_date=None):
    """Export reservations to CSV file"""
    import csv

    params = {'limit': 1000}  # Get more items at once for export
    if from_date:
        params['fromDate'] = from_date
    if to_date:
        params['toDate'] = to_date

    try:
        result = client.get_reservations(**params)
        reservations = result.get('data', [])

        if not reservations:
            print("No reservations found to export")
            return False

        with open(filename, 'w', newline='') as csvfile:
            fieldnames = [
                'id', 'resourceId', 'resourceName', 'userId', 'userName',
                'startTime', 'endTime', 'purpose', 'status', 'createdAt'
            ]
            writer = csv.DictWriter(csvfile, fieldnames=fieldnames)

            writer.writeheader()
            for res in reservations:
                # Format the data for export
                row = {
                    'id': res.get('id'),
                    'resourceId': res.get('resourceId'),
                    'resourceName': res.get('resourceName', ''),
                    'userId': res.get('userId'),
                    'userName': res.get('userName', ''),
                    'startTime': res.get('startTime'),
                    'endTime': res.get('endTime'),
                    'purpose': res.get('purpose'),
                    'status': res.get('status'),
                    'createdAt': res.get('createdAt')
                }
                writer.writerow(row)

        print(f"Exported {len(reservations)} reservations to {filename}")
        return True
    except ApiError as e:
        print(f"Error exporting reservations: {e}")
        return False
    except IOError as e:
        print(f"File error: {e}")
        return False
```

### Error Handling

```python
def safe_api_call(func, *args, **kwargs):
    """Wrapper for safe API calls with proper error handling"""
    try:
        return func(*args, **kwargs)
    except ApiError as e:
        if e.status_code == 401:
            print("Authentication required. Please log in.")
            # Could trigger re-authentication here
            return None
        elif e.status_code == 403:
            print("Permission denied. You don't have access to this resource.")
            return None
        elif e.status_code == 404:
            print(f"Resource not found: {e.message}")
            return None
        elif e.status_code == 409:
            print(f"Conflict: {e.message}")
            return None
        else:
            print(f"API error ({e.status_code}): {e.message}")
            return None
    except ConnectionError:
        print("Connection error. Please check your network.")
        return None
    except Exception as e:
        print(f"Unexpected error: {str(e)}")
        return None

# Usage
building = safe_api_call(client.get_building, 123)
if building:
    print(f"Found building: {building['name']}")
```

### Full Application Example

For a complete Python application example using this API client, see the [SARC-NG Python Client repository](https://github.com/example/sarc-ng-python-client), which includes:

- Command-line interface for all API operations
- Interactive resource booking tool
- Export/import utilities for data migration
- Scheduling integration with calendar applications
